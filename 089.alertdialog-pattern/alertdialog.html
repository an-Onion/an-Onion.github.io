<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alert Dialog Pattern - DaisyUI Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="p-8 max-w-5xl mx-auto">
  <header class="mb-8">
    <h1 class="text-3xl font-bold mb-4">Alert Dialog Pattern</h1>
    <p class="text-gray-600">使用 DaisyUI Modal 组件实现的无障碍警告对话框示例</p>
  </header>

  <!-- Demo 1: 删除确认对话框 -->
  <section class="mb-12">
    <h2 class="text-xl font-semibold mb-4">1. 删除确认对话框</h2>
    <p class="text-gray-600 mb-4">执行破坏性操作前的确认提示</p>
    <div class="flex gap-4 flex-wrap">
      <button class="btn btn-outline btn-error" onclick="confirm_dialog.showModal()">
        删除文件
      </button>
    </div>
  </section>

  <!-- Demo 2: 表单验证错误对话框 -->
  <section class="mb-12">
    <h2 class="text-xl font-semibold mb-4">2. 表单验证错误对话框</h2>
    <p class="text-gray-600 mb-4">表单提交失败时的错误提示</p>
    <div class="flex gap-4 flex-wrap">
      <button class="btn btn-primary" onclick="error_dialog.showModal()">
        提交表单
      </button>
    </div>
  </section>

  <!-- Demo 3: 未保存更改确认对话框 -->
  <section class="mb-12">
    <h2 class="text-xl font-semibold mb-4">3. 未保存更改确认</h2>
    <p class="text-gray-600 mb-4">离开页面时的未保存更改提醒</p>
    <div class="flex gap-4 flex-wrap">
      <button class="btn btn-primary" onclick="unsaved_dialog.showModal()">
        模拟未保存更改
      </button>
    </div>
  </section>

  <!-- Demo 4: 会话过期提醒 -->
  <section class="mb-12">
    <h2 class="text-xl font-semibold mb-4">4. 会话过期提醒</h2>
    <p class="text-gray-600 mb-4">用户会话即将过期的重要提醒</p>
    <div class="flex gap-4 flex-wrap">
      <button class="btn btn-primary" onclick="session_dialog.showModal()">
        模拟会话过期
      </button>
    </div>
  </section>

  <!-- Dialog 1: 删除确认 -->
  <dialog id="confirm_dialog" class="modal" role="alertdialog">
    <div class="modal-box">
      <h3 class="text-lg font-bold text-error">确认删除</h3>
      <p class="py-4">您确定要删除这个文件吗？此操作无法撤销。</p>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-ghost" value="cancel">取消</button>
          <button class="btn btn-error" value="confirm">删除</button>
        </form>
      </div>
    </div>
  </dialog>

  <!-- Dialog 2: 表单验证错误 -->
  <dialog id="error_dialog" class="modal" role="alertdialog">
    <div class="modal-box">
      <h3 class="text-lg font-bold text-error">表单验证失败</h3>
      <p class="py-4">请确保所有必填字段都已填写，并且电子邮件格式正确。</p>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-primary" value="retry">重新填写</button>
        </form>
      </div>
    </div>
  </dialog>

  <!-- Dialog 3: 未保存更改 -->
  <dialog id="unsaved_dialog" class="modal" role="alertdialog">
    <div class="modal-box">
      <h3 class="text-lg font-bold">未保存的更改</h3>
      <p class="py-4">您有未保存的更改，离开此页面将丢失这些更改。</p>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-ghost" value="stay">留在此页面</button>
          <button class="btn btn-error" value="discard">丢弃更改</button>
          <button class="btn btn-primary" value="save">保存</button>
        </form>
      </div>
    </div>
  </dialog>

  <!-- Dialog 4: 会话过期 -->
  <dialog id="session_dialog" class="modal" role="alertdialog">
    <div class="modal-box">
      <h3 class="text-lg font-bold">重要提醒</h3>
      <p class="py-4">您的会话将在 5 分钟后过期。请尽快保存您的工作。</p>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-ghost" value="exit">退出</button>
          <button class="btn btn-primary" value="continue">继续使用</button>
        </form>
      </div>
    </div>
  </dialog>

  <!-- Toast container -->
  <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div>

  <script>
    // Track the element that opened the dialog for focus management
    let previousActiveElement = null;

    // Helper function to show toast notification
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `alert alert-${type} shadow-lg`;
      toast.innerHTML = `<span>${message}</span>`;
      container.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Setup dialog focus management and close handlers
    function setupDialog(dialogId, onClose) {
      const dialog = document.getElementById(dialogId);
      const openBtn = document.querySelector(`[onclick="${dialogId}.showModal()"]`);

      if (openBtn) {
        openBtn.addEventListener('click', () => {
          previousActiveElement = document.activeElement;
        });
      }

      dialog.addEventListener('close', () => {
        const returnValue = dialog.returnValue;
        if (onClose) {
          onClose(returnValue);
        }
        // Restore focus
        if (previousActiveElement) {
          previousActiveElement.focus();
        }
      });
    }

    // Setup all dialogs
    setupDialog('confirm_dialog', (value) => {
      if (value === 'confirm') {
        showToast('文件已删除', 'success');
      } else {
        showToast('操作已取消', 'info');
      }
    });

    setupDialog('error_dialog', () => {
      showToast('请修正表单错误后重新提交', 'warning');
    });

    setupDialog('unsaved_dialog', (value) => {
      if (value === 'save') {
        showToast('更改已保存', 'success');
      } else if (value === 'discard') {
        showToast('更改已丢弃', 'error');
      } else {
        showToast('继续编辑', 'info');
      }
    });

    setupDialog('session_dialog', (value) => {
      if (value === 'continue') {
        showToast('会话已延长', 'success');
      } else {
        showToast('已退出登录', 'info');
      }
    });
  </script>
</body>
</html>
